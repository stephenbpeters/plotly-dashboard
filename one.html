<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" path1tent="width=device-width,  
        initial-scale=1.0" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
    <h1>next version of our javascript homework</h1>
    <h2>... in-line javascript loads the json fine without complain, open console</h2>
    <div id="dropme">
        <select id="selectMe" onchange="grabData()">
        </select>
    </div>
    <div id="barDiv"></div>
    <div id="bubbleDiv"></div>
    <script>

        // point ourselves to our json data file
        var url = "./samples.json";

        // build and populate our drop-down with our individuals
        function buildDrop() {
            d3.json(url, function (data) {
                console.log(data);
                // dead-end experiments here:
                // // let's start by making an object with the data we need
                // var peepsData = {};
                // // var peep = { data.samples[0].id };
                // console.log("peepsData = ",peepsData);
                // console.log("data.samples[0].id = ", data.samples[0].id);
                // var peep = [ data.samples[0].id, "foo" ];
                // console.log("peep = ",peep);
                // console.log("data.names = ", data.names);

                // build drop down from data
                d3.select('select')
                    .selectAll('option')
                    .data(data.names)
                    .enter()
                    .append('option')
                    .text(function (d) { return d; });
                // end of dropdown	 
            });
            console.log('dropdown built');
        };

        // our event handler to grab our individual to plot
        function grabData() {
            var dropdownMenu2 = d3.select("#selectMe");
            // Assign the value of the dropdown menu option to a variable
            var dropVal = dropdownMenu2.property("value");
            console.log('our dropVal = ', dropVal);
            // run and build our plot
            // send dropVal to buildPlot and buildmeta
            buildPlot(dropVal);
            // this shows us getting the value of the dropdown
            // now to select our data by that value and show in the console
        }

        buildDrop();

        // function buildPlot(ourSelection) {
        //     d3.json(url, function (data) {
        //         console.log('buildplot data load here ', data);
        //         console.log('ourSelection (string) = ', ourSelection);
        //         var theChosen = parseInt(ourSelection);
        //         console.log('the chosen one (integer) = ', theChosen);
        //         // let's get just our sample stuff
        //         var samples = data.samples;
        //         // now we filter for our chosen individual, and we want the first (and only) array in that
        //         var filteredData = samples.filter(patient => patient.id == ourSelection)[0];
        //         console.log('and like magic, our person data is = ', filteredData);
        //         var otuIDs = filteredData.otu_ids;
        //         var otuLabels = filteredData.otu_labels;
        //         var sampleValues = filteredData.sample_values;
        //         var coolNewlist = [];
        //         // console.log('foo ', samples);
        //         console.log('otuIDs = ', otuIDs);
        //         console.log('otuLabels = ', otuLabels);
        //         console.log('sampleValues = ', sampleValues);
        //         // associating our ID's with our sample values
        //         for (let i = 0; i < otuIDs.length; i++) {
        //             coolNewlist.push({
        //                 "otuID": otuIDs[i],
        //                 "otuLabel": otuLabels[i],
        //                 "sampleValue": sampleValues[i]
        //             });
        //         };
        //         console.log('coolNewlist =  ', coolNewlist);
        //         // now to sort by sample value
        //         // ex; https://stackoverflow.com/questions/8837454/sort-array-of-objects-by-single-key-with-date-value
        //         coolNewlist.sort(function (a, b) {
        //             var keyA = a.sampleValue,
        //                 keyB = b.sampleValue;
        //             // Compare the 2 dates
        //             if (keyA < keyB) return -1;
        //             if (keyA > keyB) return 1;
        //             return 0;
        //         });
        //         // now we have our list sorted, printed in reverse below, slice out the 10
        //         // console.log("our sorted cool new list = ",coolNewlist.reverse().slice(0,10));
        //         console.log("our sorted cool new list = ",coolNewlist);
        //         // looks like we may need to put this into a new list for it to work
        //         // var sliceList = coolNewlist.reverse().slice(0,10);
        //         var sortList = coolNewlist.reverse();
        //         console.log("sortList = ", sortList);
        //         var sliceList = sortList.slice(0, 10);
        //         console.log("sliceList = ", sliceList);
        //         // can we get directly to the proper sort & slice?
        //         // nope, the following two lines do not sort 'n' slice properly
        //             // var sliced2list =  coolNewlist.reverse().slice(0,10);
        //             // console.log("sliced2list = ", sliced2list);

        //         // ok, now we get our properly sorted data into our things to plot
        //         var ourX = [];
        //         var ourY = [];
        //         var ourLabels = [];
        //         sliceList.forEach( (value ) => {
        //             ourX.push(value.sampleValue);
        //             // ourY.push(value.otuID);
        //             // oops, this should be a string, maybe
        //             ourY.push(value.otuID);
        //             ourLabels.push(value.otuLabel.toString());
        //         });
        //         console.log("ourX = ", ourX);
        //         console.log("ourY = ", ourY);
        //         console.log("ourLabels = ", ourLabels);

        //         var plotData = [{
        //             x: ourX,
        //             y: ourLabels,
        //             type: 'bar',
        //             orientation: 'h'
        //         }];

        //         Plotly.newPlot('barDiv', plotData);

        //     });
        //     console.log('data loaded');
        // };






    </script>
</body>

</html>